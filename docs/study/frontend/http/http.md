# HTTP协议

- HyperText Transfer Protocol的缩写，也称为超文本传输协议，最初的版本只能用来传输html文件，现在则可以传输包括文字、图像、视频和二进制文件的所有内容。

> HTTP客户端（这里就是我们的浏览器）发起一个请求，创建一个到服务器指定端口（默认是80端口）的TCP连接。HTTP服务器则在那个端口监听客户端的请求。一旦收到请求，服务器会向客户端返回一个状态，比如"HTTP/1.1 200 OK"，以及返回的内容，如请求的文件、错误消息、或者其它信息。

- HTTP协议是无状态的，请求之间无关联。利用Cookie机制维护状态

## 网络七层模型

1. 应用层：网络服务与最终用户的一个接口。
   协议有：**HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP**
2. 表示层：数据的表示、安全、压缩。（在五层模型里面已经合并到了应用层）
   格式有：**JPEG、ASCll、DECOIC、加密格式**等
3. 会话层：建立、管理、终止会话。（在五层模型里面已经合并到了应用层）
   **对应主机进程，指本地主机与远程主机正在进行的会话**
4. 传输层：定义传输数据的协议端口号，以及流控和差错校验。
   协议有：**TCP UDP**，数据包一旦离开网卡即进入网络传输层
5. 网络层：进行逻辑地址寻址，实现不同网络之间的路径选择。
   协议有：ICMP IGMP **IP（IPV4 IPV6） ARP** RARP
6. 数据链路层：建立逻辑连接、进行硬件地址寻址、差错校验等功能。（由底层网络定义协议）
   **将比特组合成字节进而组合成帧**，用**MAC地址**访问介质，错误发现但不能纠正。
7. 物理层：建立、维护、断开物理连接。（由底层网络定义协议）

## TCP/IP协议

<span style='color:red'>不是</span>TCP和IP这两个协议的合称，而是指**因特网整个TCP/IP协议族**

从协议分层模型方面来讲，TCP/IP由四个层次组成：网络接口层、网络层、传输层、应用层。

- 网络接口层：负责接收IP数据包并通过网络发送，或者从网络上接收物理帧，抽出IP数据包，交给IP层
- 网络层：负责相邻计算机之间的通信
  - 处理来自传输层的分组发送请求，收到请求后，将分组装入IP数据报，填充报头，选择去往信宿机的路径，然后将数据报发往适当的网络接口
  - 处理输入数据报：首先检查其合法性，然后进行寻径--假如该数据报已到达信宿机，则去掉报头，将剩下部分交给适当的传输协议；假如该数据报尚未到达信宿，则转发该数据报
  - 处理路径、流控、拥塞等问题
  - ARP是正向地址解析协议，通过已知的IP，寻找对应主机的MAC地址。
  - RARP是反向地址解析协议，通过MAC地址确定IP地址。
- 传输层：提供应用程序间的通信
  - 功能：一、格式化信息流；二、提供可靠传输。
  - 为实现提供可靠传输，传输层协议规定接收端必须发回确认，并且假如分组丢失，必须重新发送，即<span style='color:red'>“三次握手”</span>过程，从而提供可靠的数据传输。
  - 传输层协议主要是：
    - 传输控制协议TCP（Transmission Control Protocol）
    - 用户数据报协议UDP（User Datagram protocol）
- 应用层：向用户提供一组常用的应用程序。
  - **FTP**（File Transfer Protocol）是文件传输协议，一般上传下载用FTP服务，数据端口是20，控制端口是21。
  - **Telnet**服务是用户远程登录服务，使用23端口，使用明码传送，保密性差、简单方便。
  - **DNS**（Domain Name Service）是域名解析服务，提供域名到IP地址之间的转换，使用端口53。
  - **SMTP**（Simple Mail Transfer Protocol）是简单邮件传输协议，用来控制信件的发送、中转，使用端口25。
  - **NFS**（Network File System）是网络文件系统，用于网络中不同主机间的文件共享。
  - **HTTP**（Hypertext Transfer Protocol）是超文本传输协议，用于实现互联网中的WWW服务，使用端口80



### 建立连接协议（三次握手）

> 3次握手是指发送了3个报文段

1. 第一次握手：客户端发送网络包，服务端收到了。

   服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的。

2. 第二次握手：服务端发包，客户端收到了。

   客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的。

3. 第三次握手：客户端发包，服务端收到了。

   服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的。

3次握手的目的：

1. 让通信双方都了解到一个连接正在建立，**让双方都得出自己、对方的接收、发送能力都正常的结论**
2. 利用数据包的选项来传输特殊的信息，交换初始序列号ISN



### 断开连接（四次挥手）

> 4次挥手是指发送了4个报文段

TCP连接是双向传输的对等的模式，就是说双方都可以同时向对方发送或接收数据。

1. 当有一方要关闭连接时，会发送FIN指令告知对方，我要关闭连接了。

2. 对方会回一个ACK，此时一个方向的连接关闭。但是另一个方向仍然可以**继续传输数据**。

3. 对方等到发送完了所有的数据后，会发送一个FIN段来关闭此方向上的连接。

4. 接收方发送ACK确认关闭连接。


注意，接收到FIN报文的一方只能回复一个ACK, 它是<span style='color:red'>无法马上返回对方一个FIN报文段</span>的，因为结束数据传输的“指令”是上层应用层给出的。













## TODO:

- websocket
- http2
- https,http,http2以及它的原形spdy有什么区别，又分别有什么优点和不足，他们的建立连接分别又有着什么环节
- 



