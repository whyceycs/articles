# HTTP相关



## 网络七层模型

1. 应用层：网络服务与最终用户的一个接口。
   协议有：**HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP**
2. 表示层：数据的表示、安全、压缩。（在五层模型里面已经合并到了应用层）
   格式有：**JPEG、ASCll、DECOIC、加密格式**等
3. 会话层：建立、管理、终止会话。（在五层模型里面已经合并到了应用层）
   **对应主机进程，指本地主机与远程主机正在进行的会话**
4. 传输层：定义传输数据的协议端口号，以及流控和差错校验。
   协议有：**TCP UDP**，数据包一旦离开网卡即进入网络传输层
5. 网络层：进行逻辑地址寻址，实现不同网络之间的路径选择。
   协议有：ICMP IGMP **IP（IPV4 IPV6） ARP** RARP
6. 数据链路层：建立逻辑连接、进行硬件地址寻址、差错校验等功能。（由底层网络定义协议）
   **将比特组合成字节进而组合成帧**，用**MAC地址**访问介质，错误发现但不能纠正。
7. 物理层：建立、维护、断开物理连接。（由底层网络定义协议）

## TCP/IP协议

<span style='color:red'>不是</span>TCP和IP这两个协议的合称，而是指**因特网整个TCP/IP协议族**

从协议分层模型方面来讲，TCP/IP由四个层次组成：网络接口层、网络层、传输层、应用层。

- 网络接口层：负责接收IP数据包并通过网络发送，或者从网络上接收物理帧，抽出IP数据包，交给IP层
- 网络层：负责相邻计算机之间的通信
  - 处理来自传输层的分组发送请求，收到请求后，将分组装入IP数据报，填充报头，选择去往信宿机的路径，然后将数据报发往适当的网络接口
  - 处理输入数据报：首先检查其合法性，然后进行寻径--假如该数据报已到达信宿机，则去掉报头，将剩下部分交给适当的传输协议；假如该数据报尚未到达信宿，则转发该数据报
  - 处理路径、流控、拥塞等问题
  - ARP是正向地址解析协议，通过已知的IP，寻找对应主机的MAC地址。
  - RARP是反向地址解析协议，通过MAC地址确定IP地址。
- 传输层：提供应用程序间的通信
  - 功能：一、格式化信息流；二、提供可靠传输。
  - 为实现提供可靠传输，传输层协议规定接收端必须发回确认，并且假如分组丢失，必须重新发送，即<span style='color:red'>“三次握手”</span>过程，从而提供可靠的数据传输。
  - 传输层协议主要是：
    - 传输控制协议TCP（Transmission Control Protocol）
    - 用户数据报协议UDP（User Datagram protocol）
- 应用层：向用户提供一组常用的应用程序。
  - **FTP**（File Transfer Protocol）是文件传输协议，一般上传下载用FTP服务，数据端口是20，控制端口是21。
  - **Telnet**服务是用户远程登录服务，使用23端口，使用明码传送，保密性差、简单方便。
  - **DNS**（Domain Name Service）是域名解析服务，提供域名到IP地址之间的转换，使用端口53。
  - **SMTP**（Simple Mail Transfer Protocol）是简单邮件传输协议，用来控制信件的发送、中转，使用端口25。
  - **NFS**（Network File System）是网络文件系统，用于网络中不同主机间的文件共享。
  - **HTTP**（Hypertext Transfer Protocol）是超文本传输协议，用于实现互联网中的WWW服务，使用端口80



## HTTP协议

- HyperText Transfer Protocol的缩写，也称为超文本传输协议，最初的版本只能用来传输html文件，现在则可以传输包括文字、图像、视频和二进制文件的所有内容。

> HTTP客户端（这里就是我们的浏览器）发起一个请求，创建一个到服务器指定端口（默认是80端口）的TCP连接。HTTP服务器则在那个端口监听客户端的请求。一旦收到请求，服务器会向客户端返回一个状态，比如"HTTP/1.1 200 OK"，以及返回的内容，如请求的文件、错误消息、或者其它信息。

- HTTP协议是无状态的，请求之间无关联。利用Cookie机制维护状态

  























## Response 响应：

### 结构：

```
http/version number | status code | message
-----------------------------------------------
Header name 1: value
header name 2: value
...
-----------------------------------------------

-----------------------------------------------
response body(optional)
```

可以看到http响应也分为三个部分：

- 第一部分是response line，包括http协议版本号，<span style='color:red'>响应状态码</span>和响应状态消息
- 第二部分是response header响应头
- 第三部分是响应体

### 状态码：

HTTP/1.1中定义了5类状态码， 状态码由三位数字组成，第一个数字定义了响应的类别

- 1XX 提示信息类 - 表示请求已被成功接收，继续处理
  - 101 协议升级，主要用于websocket，也可以用于http2的升级。
- 2XX 响应成功类 - 表示请求已被成功接收，理解，接受
  - 200 OK：成功响应状态码，最常见，表明该请求被成功地完成，所请求的资源发送回客户端
  - 201表示请求成功且服务器创建了新的资源
  - 202表示服务器已经接受了请求，但还未处理
- 3XX 重定向类 - 要完成请求必须进行更进一步的处理
  - 301表示永久重定向，请求的网页已经永久移动到新位置
  - 302表示临时重定向，新的URL会在response 中的Location中返回，浏览器将会自动使用新的URL发出新的Request
  - 304 not modified：上次的文档已经被缓存了， 还可以继续使用。<span style='color:red'>禁止包含消息体</span>。
- 4XX 客户端错误类 - 请求有语法错误或请求无法实现
  - 400 Bad Request：客户端请求与语法错误，不能被服务器所理解
  - 401：当前请求需要用户验证
  - 403 Forbidden：服务器收到请求，但是拒绝提供服务
  - 404 not found：请求资源不存在。输错URL或者服务器不存在这个页面
  - 406：请求的资源的内容特性无法满足请求头中的条件，因而无法生成响应实体。对应header中的Accept字段(text/html等...)
  - 414 ：请求的URI 长度超过了服务器能够解释的长度，因此服务器拒绝对该请求提供服务。
- 5XX 服务器端错误类 - 服务器未能实现合法的请求
  - 500 Internal Server Error：一般后端代码出错。
  - 503 Server Unavailable ：服务器当前不能处理客户端的请求，一段时间后可能恢复正常













<details>
<summary>1.重定向URI “黑洞”</summary> 

例如每次重定向把旧的 URI 作为新的 URI 的一部分，导致在若干次重定向后 URI 超长。存在安全漏洞的服务器使用固定长度的缓冲读取或操作请求的 URI，当 GET 后的参数超过某个数值后，可能会产生缓冲区溢出，导致任意代码被执行。没有此类漏洞的服务器，应当返回414状态码

</details>





























## TODO:

- websocket
- http2
- 强制缓存和协商缓存，优先读取强制缓存
- https,http,http2以及它的原形spdy有什么区别，又分别有什么优点和不足，他们的建立连接分别又有着什么环节
- 301和302有什么区别
- 重定向URI “黑洞”





